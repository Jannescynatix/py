<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KI-Textprüfer</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background-color: #f0f2f5; color: #333; line-height: 1.6; margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        h1 { color: #1a237e; text-align: center; }
        textarea { width: 100%; height: 300px; padding: 15px; font-size: 1rem; border: 2px solid #ddd; border-radius: 8px; resize: vertical; box-sizing: border-box; transition: border-color 0.3s; }
        textarea:focus { border-color: #1a237e; outline: none; }
        button { display: block; width: 100%; padding: 15px; margin-top: 20px; background-color: #1a237e; color: #fff; border: none; border-radius: 8px; font-size: 1.1rem; cursor: pointer; transition: background-color 0.3s; }
        button:hover { background-color: #263238; }
        .results { margin-top: 30px; border-top: 1px solid #ddd; padding-top: 20px; }
        .error-item { background: #fff3e0; border-left: 5px solid #ff9800; padding: 15px; margin-bottom: 15px; border-radius: 4px; }
        .error-message { font-weight: bold; color: #d66d00; }
        .error-context { font-family: monospace; background-color: #eceff1; padding: 5px; border-radius: 4px; }
        .error-replacements span { background-color: #81c784; color: #fff; padding: 2px 8px; border-radius: 12px; margin-right: 5px; }
        #loading { display: none; text-align: center; margin-top: 20px; }
        .spinner { border: 4px solid rgba(0,0,0,.1); width: 36px; height: 36px; border-radius: 50%; border-left-color: #1a237e; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
<div class="container">
    <h1>Ihr KI-Textprüfer</h1>
    <p>Fügen Sie Ihren Text ein und klicken Sie auf "Prüfen", um Fehler zu finden und Verbesserungsvorschläge zu erhalten.</p>
    <textarea id="inputText" placeholder="Geben Sie hier Ihren Text ein..." oninput="clearResults()"></textarea>
    <button onclick="checkText()" id="checkButton">Text prüfen</button>
    <div id="loading">
        <div class="spinner"></div>
        <p>Text wird geprüft...</p>
    </div>
    <div class="results" id="results"></div>
</div>

<script>
    const checkButton = document.getElementById('checkButton');
    const loadingDiv = document.getElementById('loading');
    const resultsDiv = document.getElementById('results');

    function clearResults() {
        resultsDiv.innerHTML = '';
    }

    async function checkText() {
        const inputText = document.getElementById('inputText').value;
        if (!inputText.trim()) {
            resultsDiv.innerHTML = '<p style="color:red;">Bitte geben Sie Text zum Prüfen ein.</p>';
            return;
        }

        // Ladezustand anzeigen
        checkButton.disabled = true;
        loadingDiv.style.display = 'block';
        resultsDiv.innerHTML = '';

        try {
            const response = await fetch('/check', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ text: inputText }),
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || 'Ein Fehler ist aufgetreten.');
            }

            const data = await response.json();

            if (data.errors && data.errors.length > 0) {
                data.errors.forEach(error => {
                    const errorElement = document.createElement('div');
                    errorElement.className = 'error-item';

                    let replacementsHTML = '';
                    if (error.replacements && error.replacements.length > 0) {
                        replacementsHTML = `<p><strong>Vorschläge:</strong> ${error.replacements.map(rep => `<span>${rep}</span>`).join('')}</p>`;
                    }

                    errorElement.innerHTML = `
                            <p class="error-message"><strong>Fehler:</strong> ${error.message}</p>
                            <p><strong>Art des Fehlers:</strong> ${error.rule_type}</p>
                            <p><strong>Kontext:</strong> <span class="error-context">${error.context.text.substring(0, error.context.offset)}<mark>${error.context.text.substring(error.context.offset, error.context.offset + error.length)}</mark>${error.context.text.substring(error.context.offset + error.length)}</span></p>
                            ${replacementsHTML}
                        `;
                    resultsDiv.appendChild(errorElement);
                });
            } else {
                resultsDiv.innerHTML = '<p style="color:green;">✅ Keine Fehler gefunden. Ihr Text ist perfekt!</p>';
            }
        } catch (error) {
            resultsDiv.innerHTML = `<p style="color:red;">Ein Fehler ist aufgetreten: ${error.message}</p>`;
        } finally {
            // Ladezustand beenden
            checkButton.disabled = false;
            loadingDiv.style.display = 'none';
        }
    }
</script>
</body>
</html>